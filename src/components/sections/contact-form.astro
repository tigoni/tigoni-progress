---
import { Send, User, Mail, MessageSquare } from "lucide-react";
import Box from "@/components/box/index.astro";
import BoxHeader from "@/components/box/header.astro";
import BoxTitle from "@/components/box/title.astro";
import BoxContent from "@/components/box/content.astro";
---

<Box id="contact-form">
  <BoxHeader class="pb-2 px-0">
    <BoxTitle className="px-8 text-xl tracking-tight opacity-70">
      Get in Touch
    </BoxTitle>
  </BoxHeader>
  <BoxContent className="px-8 pb-16 pt-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
      <div class="space-y-6">
        <h3 class="text-3xl font-black tracking-tighter text-foreground md:text-4xl">
          Have a project in mind? <br/>
          <span class="text-primary/60">Let's build it.</span>
        </h3>
        <p class="text-muted-foreground/80 leading-relaxed">
          I'm currently available for senior-level consulting, blockchain architecture audits, and high-performance backend development. 
        </p>
        
        <div class="space-y-4 pt-4">
          <div class="flex items-center gap-4 text-sm font-medium text-muted-foreground">
            <div class="size-2 rounded-full bg-green-500 animate-pulse"></div>
            Currently accepting new clients
          </div>
          <p class="text-xs font-mono uppercase tracking-widest text-muted-foreground/50">
            Average response time: &lt; 24 hours
          </p>
        </div>
      </div>

      <div id="form-container" class="flex flex-col gap-6">
        <form 
          id="ajax-contact-form"
          action="https://formspree.io/f/maqnabbp" 
          method="POST" 
          class="flex flex-col gap-6"
        >
          <div class="group relative">
            <User className="absolute left-4 top-1/2 -translate-y-1/2 size-4 text-muted-foreground/40 transition-colors group-focus-within:text-primary" />
            <input 
              type="text" 
              name="name" 
              placeholder="Your Name" 
              required
              class="w-full rounded-xl border border-border/50 bg-muted/10 py-4 pl-12 pr-4 text-sm transition-all focus:border-primary/30 focus:bg-background focus:outline-none focus:ring-4 focus:ring-primary/5"
            />
          </div>

          <div class="group relative">
            <Mail className="absolute left-4 top-1/2 -translate-y-1/2 size-4 text-muted-foreground/40 transition-colors group-focus-within:text-primary" />
            <input 
              type="email" 
              name="email" 
              placeholder="Your Email" 
              required
              class="w-full rounded-xl border border-border/50 bg-muted/10 py-4 pl-12 pr-4 text-sm transition-all focus:border-primary/30 focus:bg-background focus:outline-none focus:ring-4 focus:ring-primary/5"
            />
          </div>

          <div class="group relative">
            <MessageSquare className="absolute left-4 top-6 size-4 text-muted-foreground/40 transition-colors group-focus-within:text-primary" />
            <textarea 
              name="message" 
              rows="5" 
              placeholder="Briefly describe your project or inquiry..." 
              required
              class="w-full rounded-xl border border-border/50 bg-muted/10 py-4 pl-12 pr-4 text-sm transition-all focus:border-primary/30 focus:bg-background focus:outline-none focus:ring-4 focus:ring-primary/5"
            ></textarea>
          </div>

          <button 
            type="submit" 
            id="submit-btn"
            class="group flex items-center justify-center gap-2 rounded-full bg-primary py-4 text-sm font-bold text-primary-foreground transition-all hover:scale-[1.02] hover:bg-primary/90 active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span id="btn-text">Send Message</span>
            <Send id="btn-icon" className="size-4 transition-transform group-hover:translate-x-1 group-hover:-translate-y-1" />
          </button>
        </form>
      </div>

      <!-- Success Message (Initially Hidden) -->
      <div id="success-message" class="hidden flex flex-col items-center justify-center text-center p-8 space-y-4 animate-fade-in">
        <div class="size-16 rounded-full bg-primary/10 flex items-center justify-center mb-4">
          <Send className="size-8 text-primary" />
        </div>
        <h3 class="text-2xl font-black tracking-tighter">Message Sent!</h3>
        <p class="text-muted-foreground leading-relaxed max-w-sm">
          Thank you for reaching out. I've received your message and will get back to you within 24 hours.
        </p>
        <button 
          onclick="window.location.reload()"
          class="text-xs font-bold uppercase tracking-widest text-primary/70 hover:text-primary transition-colors underline underline-offset-8 mt-4"
        >
          Send another message
        </button>
      </div>
    </div>
  </BoxContent>

  <script is:inline>
    document.addEventListener("astro:page-load", () => {
      const form = document.getElementById("ajax-contact-form");
      const formContainer = document.getElementById("form-container");
      const successMessage = document.getElementById("success-message");
      const submitBtn = document.getElementById("submit-btn");
      const btnText = document.getElementById("btn-text");

      if (form) {
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          
          // Show loading state
          submitBtn.disabled = true;
          btnText.textContent = "Sending...";

          const formData = new FormData(form);
          
          try {
            const response = await fetch(form.action, {
              method: 'POST',
              body: formData,
              headers: {
                'Accept': 'application/json'
              }
            });

            if (response.ok) {
              formContainer.classList.add('hidden');
              successMessage.classList.remove('hidden');
            } else {
              const data = await response.json();
              alert(data.errors ? data.errors.map(error => error.message).join(", ") : "Oops! There was a problem submitting your form");
              submitBtn.disabled = false;
              btnText.textContent = "Send Message";
            }
          } catch (error) {
            alert("Oops! There was a problem submitting your form");
            submitBtn.disabled = false;
            btnText.textContent = "Send Message";
          }
        });
      }
    });
  </script>
</Box>
