---
import type { CollectionEntry } from "astro:content";
import { 
  ChevronRightIcon, 
  BookOpen, 
  Terminal, 
  Database, 
  Cpu, 
  Hash,
  Clock
} from "lucide-react";
import getReadingTime from "reading-time";

interface Props {
  article: CollectionEntry<"blog">;
}

const { article } = Astro.props;

// Map categories to icons
const categoryIcons: Record<string, any> = {
  "Backend": Database,
  "Frontend": Terminal,
  "Cloud": Cpu,
  "Web3": Hash,
  "Development": BookOpen,
};

const Icon = categoryIcons[article.data.category] || BookOpen;

const formattedDate = new Intl.DateTimeFormat("en-GB", {
  day: "2-digit",
  month: "short",
  year: "numeric",
}).format(article.data.pubDatetime);
---

<div class="group relative flex w-full flex-col transition-all duration-500 hover:bg-muted/5">
  <!-- Stretched Link -->
  <a 
    href={`/articles/${article.id}`} 
    class="absolute inset-0 z-0" 
    aria-label={`Read Article: ${article.data.title}`}
  ></a>

  <div class="relative z-1 pointer-events-none flex flex-col gap-5 p-8">
    <div class="flex items-start justify-between gap-6">
      <div class="flex-1 space-y-3">
        <!-- Meta Row -->
        <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-[10px] font-bold uppercase tracking-[0.2em] text-muted-foreground/50">
          <span class="flex items-center gap-1.5 text-primary/60">
            <Icon className="size-3" />
            {article.data.category}
          </span>
          <span class="flex items-center gap-1.5">
            <Clock className="size-3" />
            {getReadingTime(article.body!).text}
          </span>
          <span>{formattedDate}</span>
        </div>

        <!-- Title -->
        <h3 class="text-xl font-black tracking-tight text-foreground/90 transition-colors group-hover:text-foreground">
          {article.data.title}
        </h3>

        <!-- Description -->
        <p class="line-clamp-2 text-sm leading-relaxed text-muted-foreground/70 group-hover:text-muted-foreground/90 transition-colors">
          {article.data.description}
        </p>
      </div>

      <div class="shrink-0 pt-1">
        <div class="flex size-10 items-center justify-center rounded-xl border border-border/50 bg-muted/20 transition-all duration-500 group-hover:border-primary/20 group-hover:bg-primary/5">
          <ChevronRightIcon className="size-4 text-muted-foreground/40 transition-transform duration-300 group-hover:translate-x-1 group-hover:text-primary" />
        </div>
      </div>
    </div>

    <!-- Tags -->
    <div class="flex flex-wrap gap-2 pt-1">
      {
        article.data.tags.map(tag => (
          <span class="text-[9px] font-bold uppercase tracking-widest text-muted-foreground/30 group-hover:text-muted-foreground/50 transition-colors">
            #{tag}
          </span>
        ))
      }
    </div>
  </div>
</div>
